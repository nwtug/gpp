-- phpMyAdmin SQL Dump
-- version 4.1.12
-- http://www.phpmyadmin.net
--
-- Host: 127.0.0.1
-- Generation Time: Feb 01, 2016 at 10:19 AM
-- Server version: 5.6.16
-- PHP Version: 5.5.11

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;

--
-- Database: `pss_v1`
--

-- --------------------------------------------------------

--
-- Table structure for table `queries`
--

CREATE TABLE IF NOT EXISTS `queries` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `code` varchar(300) NOT NULL,
  `details` text NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=165 ;

--
-- Dumping data for table `queries`
--

INSERT INTO `queries` (`id`, `code`, `details`) VALUES
(1, 'add_event_log', 'INSERT INTO activity_trail (user_id, activity_code, result, uri, log_details, ip_address, event_time)\nVALUES (''_USER_ID_'', ''_ACTIVITY_CODE_'', ''_RESULT_'', ''_URI_'', ''_LOG_DETAILS_'', ''_IP_ADDRESS_'', NOW())'),
(2, 'get_user_by_name_and_pass', 'SELECT id AS user_id, user_name, email_address, first_name  FROM users WHERE user_name=''_LOGIN_NAME_'' AND password=''_LOGIN_PASSWORD_'' AND status=''active'''),
(3, 'get_user_by_id', 'SELECT U.id, U._organization_id AS organization_id, U.user_name, U.id AS user_id, U.first_name, U.last_name, U.email_address, U.email_verified, U.telephone, U.otherphone, U._telephone_carrier_id AS carrier_id, U.photo_url, U.address_line_1 AS address, U.city, U.state, U.zipcode, U.country AS country_id, U.secret_question, U._permission_group_id AS permission_group_id, U.status, \r\n(SELECT name FROM countries WHERE id=U.country LIMIT 1) AS country,   \r\n(SELECT id FROM secret_questions WHERE question=U.secret_question LIMIT 1) AS secret_question_id,\r\n(SELECT carrier_name FROM telephone_carriers WHERE id=U._telephone_carrier_id LIMIT 1) AS telephone_carrier, \r\n(SELECT type FROM permission_groups WHERE id=U._permission_group_id LIMIT 1) AS group_type, \r\n(SELECT name FROM organizations WHERE id=U._organization_id LIMIT 1) AS organization_name,\r\nIF((SELECT id FROM organizations WHERE _owner_user_id=U.id AND id=U._organization_id LIMIT 1) IS NOT NULL, ''Y'', ''N'') AS is_owner\r\n\r\nFROM users U \r\nWHERE id=''_USER_ID_'''),
(4, 'get_user_permissions', 'SELECT P.code AS permission_code FROM users U  \nLEFT JOIN permission_group_mapping PM ON (U._permission_group_id=PM._group_id) \nLEFT JOIN permissions P ON (PM._permission_id=P.id) \nWHERE U.id=''_USER_ID_'' AND P.code IS NOT NULL'),
(5, 'get_user_group_type', 'SELECT G.type AS group_type FROM users U \nLEFT JOIN permission_groups G ON (G.id=U._permission_group_id) \nWHERE U.id=''_USER_ID_'''),
(6, 'get_business_categories', 'SELECT * FROM business_categories'),
(7, 'get_countries_list', 'SELECT * FROM countries ORDER BY display_order ASC, name ASC'),
(8, 'get_secret_questions', 'SELECT * FROM secret_questions ORDER BY question ASC'),
(9, 'check_user_name', 'SELECT * FROM users WHERE user_name=''_USER_NAME_'''),
(10, 'get_government_ministries', 'SELECT * FROM ministries ORDER BY name'),
(11, 'get_best_evaluated_bidders', 'SELECT N.name AS notice_name, N.type,  N.note, N.display_start_date AS posted_date, \n(SELECT name FROM procurement_categories WHERE id=N._category_id LIMIT 1) AS category, \n(SELECT name FROM organizations WHERE id=B._organization_id LIMIT 1) AS entity_name, \n(SELECT name FROM organizations WHERE id=B._submitted_by LIMIT 1) AS provider_name, \nN.deadline\n\nFROM bids B\nLEFT JOIN tender_notices N ON (B._tender_notice_id=N.id)\nLEFT JOIN bid_status BS ON (B.id=BS._bid_id AND BS.status=''won'')\n\nWHERE BS._bid_id IS NOT NULL \nORDER BY BS.date_entered DESC \n_LIMIT_TEXT_'),
(12, 'get_message_template', 'SELECT *, copy_admin AS copyadmin FROM message_templates WHERE message_type=''_MESSAGE_TYPE_'''),
(13, 'record_message_exchange', 'INSERT INTO message_exchange (_template_id, details, `subject`, attachment_url, _sender_id, _recipient_id, date_entered)\r\n\r\n(SELECT T.id AS _template_id, ''_DETAILS_'' AS details, ''_SUBJECT_'' AS `subject`, ''_ATTACHMENT_URL_'' AS attachment_url, \r\n''_SENDER_ID_'' AS _sender_id, \r\nU.id AS _recipient_id, NOW() AS date_entered\r\nFROM message_templates T LEFT JOIN users U ON (U.id IN (''_RECIPIENT_ID_'')) WHERE T.message_type=''_TEMPLATE_CODE_'')\r\n\r\nON DUPLICATE KEY UPDATE `subject`=VALUES(`subject`), details=VALUES(details), attachment_url=VALUES(attachment_url), date_entered=VALUES(date_entered)'),
(14, 'get_accounts_of_type', 'SELECT U.id AS _user_id FROM users U \nLEFT JOIN permission_groups G ON (U._permission_group_id=G.id) \nWHERE G.type=''_ACCOUNT_TYPE_'' \nGROUP BY U.id '),
(15, 'save_temp_organization', 'INSERT INTO organizations (name, description, _owner_user_id,  _registration_country_id, registration_number, tax_id, _category_id, _ministry_id, date_established, date_entered, _entered_by, last_updated, _last_updated_by) VALUES \n(''_NAME_'', ''_DESCRIPTION_'', ''_USER_ID_'', ''_REGISTRATION_COUNTRY_ID_'', ''_REGISTRATION_NUMBER_'', ''_TAX_ID_'', ''_CATEGORY_ID_'', ''_MINISTRY_ID_'', ''_DATE_ESTABLISHED_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')\n\nON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), _registration_country_id=VALUES(_registration_country_id), registration_number=VALUES(registration_number),_category_id=VALUES(_category_id), _ministry_id=VALUES(_ministry_id), date_established=VALUES(date_established), last_updated=NOW(), _last_updated_by=''_USER_ID_'''),
(16, 'save_temp_user', 'INSERT INTO users (email_address, telephone, otherphone, country, user_name, password, secret_answer, secret_question, date_entered, last_updated) \r\n(SELECT ''_EMAIL_ADDRESS_'' AS email_address, ''_TELEPHONE_'' AS telephone, ''_OTHERPHONE_'' AS otherphone, ''_COUNTRY_'' AS country, ''_USER_NAME_'' AS user_name, ''_PASSWORD_'' AS password, ''_SECRET_ANSWER_'' AS secret_answer, \r\n(SELECT question FROM secret_questions WHERE id=''_SECRET_QUESTION_ID_'') AS secret_question, \r\nNOW() AS date_entered, NOW() AS last_updated) \r\n\r\nON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), telephone=VALUES(telephone), password=VALUES(password), secret_answer=VALUES(secret_answer), secret_question=VALUES(secret_question), last_updated=NOW()'),
(17, 'remove_temp_user', 'DELETE FROM users WHERE id=''_USER_ID_'''),
(18, 'remove_temp_organization', 'DELETE FROM organizations WHERE id=''_ORGANIZATION_ID_'''),
(19, 'update_organization_contact', 'UPDATE organizations SET contact_address=''_CONTACT_ADDRESS_'', contact_city=''_CONTACT_CITY_'', contact_region=''_CONTACT_REGION_'', contact_zipcode=''_CONTACT_ZIPCODE_'', contact_country_id=''_CONTACT_COUNTRY_ID_''\r\n\r\nWHERE id=''_ORGANIZATION_ID_'''),
(20, 'activate_user_account', 'UPDATE users SET \r\nfirst_name=''_FIRST_NAME_'', last_name=''_LAST_NAME_'', _organization_id=''_ORGANIZATION_ID_'', email_verified=''Y'', status=''_STATUS_'', _entered_by=''_USER_ID_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'',\r\n _permission_group_id = (SELECT id FROM permission_groups WHERE type=''_ORGANIZATION_TYPE_'' AND is_removable=''N'' LIMIT 1)\r\n\r\n WHERE id=''_USER_ID_'''),
(21, 'get_audit_trail', 'SELECT T.event_time AS event_date, T.result, T.uri, T.ip_address,   \n\nIF(T.user_id = ''system'', ''SYSTEM'', \nIF(T.user_id IS NULL OR T.user_id = '''' OR T.user_id = ''0'', ''UNKNOWN'',\nIFNULL((SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=T.user_id), ''UNKNOWN'')\n)) AS name,\n \nREPLACE(T.activity_code, ''_'', '' '') AS activity_code, \nREPLACE(REPLACE(T.log_details, ''|'', ''<br>''), ''='', '' = '') AS details\n\nFROM activity_trail T \nWHERE 1=1 _DATE_CONDITION_ _USER_CONDITION_ _ACTIVITY_CONDITION_ _PHRASE_CONDITION_ \nORDER BY event_time DESC \n_LIMIT_TEXT_ \n'),
(22, 'search_user_list', 'SELECT id AS user_id, CONCAT(first_name, '' '', last_name) AS name FROM users WHERE first_name LIKE CONCAT(''%'',''_PHRASE_'',''%'') OR last_name LIKE CONCAT(''%'',''_PHRASE_'',''%'') OR email_address LIKE CONCAT(''%'',''_PHRASE_'',''%'') \n\n_LIMIT_TEXT_'),
(23, 'get_activity_codes', 'SELECT DISTINCT activity_code AS code, REPLACE(activity_code, ''_'', '' '') AS display_code FROM activity_trail \nWHERE activity_code <> '''' AND activity_code IS NOT NULL \nORDER BY activity_code'),
(24, 'get_user_list', 'SELECT U.id AS user_id, U._organization_id AS organization_id, CONCAT(first_name, '' '', last_name) AS name, U.first_name, U.last_name, email_address, telephone, status, date_entered AS date_created, _permission_group_id AS group_id, \n(SELECT name FROM countries WHERE id=U.country LIMIT 1) AS country, \n(SELECT name FROM organizations WHERE id=U._organization_id LIMIT 1) AS organization,\n(SELECT name FROM permission_groups WHERE id=U._permission_group_id LIMIT 1) AS permission_group,\n(SELECT type FROM permission_groups WHERE id=U._permission_group_id LIMIT 1) AS user_type,\nIF((SELECT id FROM organizations WHERE _owner_user_id=U.id AND id=U._organization_id LIMIT 1) IS NOT NULL, ''Y'', ''N'') AS is_owner\n \nFROM users U WHERE 1=1 _GROUP_CONDITION_ _TYPE_CONDITION_ _ORGANIZATION_CONDITION_ _PHRASE_CONDITION_ _LIMIT_TEXT_'),
(25, 'get_permissions_by_group_id', 'SELECT P.display AS permission FROM permission_group_mapping M LEFT JOIN permissions P ON (M._permission_id=P.id) WHERE M._group_id=''_GROUP_ID_'''),
(26, 'update_user_status', 'UPDATE users SET status=''_NEW_STATUS_'' WHERE id IN (''_USER_LIST_'')'),
(27, 'update_organization_status_by_user_ids', 'UPDATE organizations SET status = ''_NEW_STATUS_'' WHERE id IN (SELECT DISTINCT _organization_id FROM users WHERE id IN (''_USER_LIST_''))'),
(28, 'get_provider_list', 'SELECT O.id AS organization_id, O.name, O.tax_id, O.rop_number, O.rop_certificate_url, O.status, O.date_established AS date_registered, O.expiry_date, O.date_entered AS date_created, O._owner_user_id AS contact_id,  \n\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=O._owner_user_id LIMIT 1) AS contact_name, \n\nIF(O._category_id > 0, (SELECT name FROM business_categories WHERE id=O._category_id LIMIT 1), '''') AS category, \n\nIF(O._ministry_id > 0, (SELECT name FROM ministries WHERE id=O._ministry_id LIMIT 1), '''') AS ministry, \n\n(SELECT name FROM countries WHERE id=O._registration_country_id LIMIT 1) AS country, \nCONCAT(contact_address, '' '', '', '', contact_city, '', '', contact_region, '' '', contact_zipcode, '', '',(SELECT name FROM countries WHERE id=contact_country_id LIMIT 1)) AS address, \n\nIFNULL((SELECT start_date FROM registration_status_track WHERE _organization_id=O.id AND status=O.status ORDER BY start_date DESC LIMIT 1), NOW()) AS status_start_date, \n\nIFNULL((SELECT end_date FROM registration_status_track WHERE _organization_id=O.id AND status=O.status ORDER BY start_date DESC LIMIT 1), ''ONGOING'') AS status_end_date,\n\nIFNULL((SELECT reason FROM registration_status_track WHERE _organization_id=O.id AND status=O.status ORDER BY start_date DESC LIMIT 1), ''ONGOING'') AS status_reason\n\nFROM organizations O \nWHERE (SELECT G.type FROM users U LEFT JOIN permission_groups G ON (G.id=U._permission_group_id) WHERE U.id=O._owner_user_id LIMIT 1) = ''provider'' _CATEGORY_CONDITION_ _MINISTRY_CONDITION_ _COUNTRY_CONDITION_ _PHRASE_CONDITION_  _STATUS_CONDITION_ \n\nORDER BY O.status \n_LIMIT_TEXT_'),
(29, 'get_tender_list', 'SELECT T.id AS tender_id, T.name AS subject, T.reference_number, T.type AS procurement_type, (SELECT name FROM procurement_categories WHERE id=T._category_id LIMIT 1) AS  procurement_category, T.method AS procurement_method, T.deadline, T.display_start_date, T.display_end_date, T.date_entered AS date_created, T._procurement_plan_id AS plan_id, \r\nIF(T.status=''published'',IF(T.method LIKE ''%_competitive%'', ''published'',''issued''), T.status) AS status, \r\n\r\nIFNULL((SELECT id FROM bids WHERE _tender_notice_id=T.id AND _organization_id=''_ORGANIZATION_ID_'' AND status IN (''submitted'',''under_review'',''won'',''awarded'',''complete'') LIMIT 1), '''') AS bid_id, \r\n\r\nIFNULL((SELECT status FROM bids WHERE _tender_notice_id=T.id AND _organization_id=''_ORGANIZATION_ID_'' LIMIT 1), '''') AS my_bid_status, \r\n\r\nIFNULL((SELECT id FROM bids WHERE _tender_notice_id=T.id AND _organization_id=''_ORGANIZATION_ID_'' AND status=''saved'' LIMIT 1), '''') AS draft_bid_id, \r\n\r\n(SELECT CONCAT(title,'' '', DATE_FORMAT(financial_year_start, ''%Y''),''-'',DATE_FORMAT(financial_year_end, ''%Y'')) FROM procurement_plans WHERE id=T._procurement_plan_id LIMIT 1) AS procurement_plan, \r\n\r\n(SELECT _organization_id FROM procurement_plans WHERE T._procurement_plan_id=id LIMIT 1) AS pde_id, \r\n\r\n(SELECT O.name FROM procurement_plans P LEFT JOIN organizations O ON (P._organization_id=O.id) WHERE T._procurement_plan_id=P.id LIMIT 1) AS pde, \r\n\r\n(SELECT COUNT(*) FROM bids WHERE _tender_notice_id=T.id) AS bid_count,\r\n\r\n(SELECT COUNT(_provider_id) FROM tender_invitations WHERE _tender_id=T.id) AS invite_count\r\n\r\nFROM tender_notices T \r\n\r\nWHERE 1=1 _DISPLAY_CONDITION_ _METHOD_CONDITION_ _TYPE_CONDITION_ _STATUS_CONDITION_ _OWNER_CONDITION_ _PHRASE_CONDITION_ _DEADLINE_CONDITION_ \r\n_PDE_CONDITION_ \r\nORDER BY last_updated DESC \r\n_LIMIT_TEXT_ '),
(30, 'get_procurement_plan_list', 'SELECT P._organization_id AS pde_id, P.id AS procurement_plan_id, P.title AS name, P.financial_year_start, P.financial_year_end, P.status, P.date_entered AS date_created, \n(SELECT name FROM organizations WHERE id=P._organization_id LIMIT 1) AS pde\n\nFROM procurement_plans P WHERE 1=1 _PDE_CONDITION_ _STATUS_CONDITION_ _PHRASE_CONDITION_ \nORDER BY last_updated DESC \n_LIMIT_TEXT_ '),
(31, 'get_bid_list', 'SELECT B.id AS bid_id, B.date_submitted, B.summary, B.bid_amount, B.bid_currency, B.final_contract_amount, B.final_amount_currency, B.valid_start_date, B.valid_end_date, B.status, B.last_updated, B._organization_id AS provider_id, B._tender_notice_id AS tender_id,  \r\n\r\n(SELECT name FROM organizations WHERE id = B._organization_id LIMIT 1) AS provider, \r\n\r\n(SELECT O.name FROM tender_notices N LEFT JOIN organizations O ON (N._organization_id=O.id) WHERE N.id=B._tender_notice_id LIMIT 1) AS pde, \r\n\r\n(SELECT N._organization_id FROM tender_notices N WHERE N.id=B._tender_notice_id LIMIT 1) AS pde_id, \r\n\r\n(SELECT CONCAT(P.title,'' '', DATE_FORMAT(P.financial_year_start, ''%Y''),''-'',DATE_FORMAT(P.financial_year_end, ''%Y'')) FROM tender_notices N LEFT JOIN procurement_plans P ON (P.id=N._procurement_plan_id) WHERE N.id=B._tender_notice_id LIMIT 1) AS procurement_plan, \r\n\r\n(SELECT GROUP_CONCAT(document_url) FROM bid_documents WHERE _bid_id=B.id) AS documents, \r\n\r\n(SELECT name FROM tender_notices WHERE id = B._tender_notice_id LIMIT 1) AS tender_notice,\r\n\r\n(SELECT reference_number FROM tender_notices WHERE id = B._tender_notice_id LIMIT 1) AS reference_number,\r\n\r\nIFNULL((SELECT id FROM contracts WHERE _tender_id=B._tender_notice_id AND  _organization_id=B._organization_id LIMIT 1), 0) AS contract_id \r\n\r\nFROM bids B \r\n\r\nWHERE 1=1 _PROVIDER_CONDITION_ _STATUS_CONDITION_ _PHRASE_CONDITION_ _PDE_CONDITION_ \r\nORDER BY last_updated DESC \r\n_LIMIT_TEXT_'),
(32, 'search_pde_list', 'SELECT O.id AS pde_id, O.name \nFROM organizations O LEFT JOIN users U ON (O._owner_user_id=U.id) LEFT JOIN permission_groups G ON (U._permission_group_id=G.id) \n\nWHERE G.type = ''pde'' AND O.name LIKE ''%_PHRASE_%'' _LIMIT_TEXT_'),
(34, 'get_procurement_methods', 'SELECT code, method FROM procurement_methods WHERE 1=1 _METHOD_CONDITION_'),
(35, 'search_procurement_plan_list', 'SELECT id AS plan_id, CONCAT(''&#x25FE; '', (SELECT name FROM organizations WHERE id=P._organization_id LIMIT 1),'' ['', title,'' - '', DATE_FORMAT(financial_year_start,''%Y''),'' TO '',DATE_FORMAT(financial_year_end,''%Y''), '']'') AS name \r\nFROM procurement_plans P \r\nWHERE status=''published'' _ORGANIZATION_CONDITION_ \r\nHAVING name LIKE ''%_PHRASE_%'' \r\n_LIMIT_TEXT_'),
(36, 'add_procurement_plan', 'INSERT INTO procurement_plans (_organization_id, financial_year_start, financial_year_end, title, details, document_url, status, date_entered, _entered_by, last_updated, _last_updated_by) VALUES (''_ORGANIZATION_ID_'',  ''_FINANCIAL_YEAR_START_'', ''_FINANCIAL_YEAR_END_'', ''_TITLE_'', ''_DETAILS_'', ''_DOCUMENT_URL_'', ''_STATUS_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')'),
(37, 'add_tender_notice', 'INSERT INTO tender_notices (name, subject_id, reference_number, details, type, _category_id, method, _organization_id, _procurement_plan_id, document_url, deadline, display_start_date, display_end_date, status, date_entered, _entered_by, last_updated, _last_updated_by) \n\n(SELECT ''_NAME_'' AS name, ''_SUBJECT_ID_'' AS subject_id, ''_REFERENCE_NUMBER_'' AS reference_number, ''_DETAILS_'' AS details, ''_TYPE_'' AS type, \n\n(SELECT C.id FROM procurement_categories C WHERE LOWER(name) = LOWER(IFNULL((SELECT B FROM procurement_plan_details WHERE _plan_id=''_PROCUREMENT_PLAN_ID_'' AND SUBSTRING_INDEX((SELECT A FROM procurement_plan_details WHERE id=''_SUBJECT_ID_'' LIMIT 1), ''.'',1) = A LIMIT 1), ''Other''))) AS _category_id, \n\n(SELECT LOWER(REPLACE(C,'' '',''_'')) FROM procurement_plan_details WHERE id=''_SUBJECT_ID_'' LIMIT 1) AS method, \n(SELECT _organization_id FROM procurement_plans WHERE id=''_PROCUREMENT_PLAN_ID_'' LIMIT 1) AS _organization_id, \n''_PROCUREMENT_PLAN_ID_'' AS _procurement_plan_id, ''_DOCUMENT_URL_'' AS document_url, ''_DEADLINE_'' AS deadline, ''_DISPLAY_START_DATE_'', ''_DISPLAY_END_DATE_'', ''_STATUS_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')'),
(38, 'get_organization_details_by_id', 'SELECT id AS organization_id, name, description, tax_id, registration_number, status, date_entered, last_updated, contact_address, contact_city, contact_region, contact_zipcode, contact_country_id, rop_number, rop_certificate_url, \n\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=O._owner_user_id LIMIT 1) AS owner, \n\nIFNULL(logo_url, '''') AS logo_url, \n\n(SELECT name FROM countries WHERE id = O._registration_country_id LIMIT 1) AS registration_country, \n\n(SELECT name FROM countries WHERE id = O.contact_country_id  LIMIT 1) AS contact_country, \n\nIF(O._ministry_id > 0, (SELECT name FROM ministries WHERE id=O._ministry_id LIMIT 1), (SELECT name FROM business_categories WHERE id=O._category_id LIMIT 1)) AS category_or_ministry, \n\n(SELECT CONCAT(contact_address, '', '', contact_city, '', '', contact_region,'' '', contact_zipcode, '', '', (SELECT name FROM countries WHERE id=O.contact_country_id LIMIT 1)) ) AS address, \n\nIF(O.date_established = ''0000-00-00'', '''', O.date_established) AS date_established, \n\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=O._entered_by LIMIT 1) AS entered_by, \n\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=O._last_updated_by LIMIT 1) AS last_updated_by\n\nFROM organizations O \nWHERE id=''_ORGANIZATION_ID_'''),
(39, 'get_tender_notice', 'SELECT N.id AS tender_id, N.name, N.reference_number, N._procurement_plan_id AS plan_id, N.subject_id, N.details AS description, N.type, (SELECT name FROM procurement_categories WHERE id=N._category_id LIMIT 1) AS category, N.method, N.document_url, N.deadline, N.display_start_date, N.display_end_date, N.status, N.date_entered, N.last_updated, \r\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=N._entered_by LIMIT 1) AS entered_by, \r\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=N._last_updated_by LIMIT 1) AS last_updated_by, \r\n(SELECT name FROM organizations WHERE id = N._organization_id LIMIT 1) AS pde, \r\n(SELECT CONCAT(title,'' '', DATE_FORMAT(financial_year_start, ''%Y''),''-'',DATE_FORMAT(financial_year_end, ''%Y'')) FROM procurement_plans WHERE id=N._procurement_plan_id LIMIT 1) AS procurement_plan, \r\n(SELECT B FROM procurement_plan_details WHERE id=N.subject_id LIMIT 1) AS subject\r\n\r\nFROM tender_notices N \r\nWHERE N.id = ''_TENDER_ID_'''),
(40, 'get_procurement_plan', 'SELECT P._organization_id AS pde_id, P.id AS procurement_plan_id, P.title AS name, P.details, P.document_url, P.financial_year_start, P.financial_year_end, P.status, P.date_entered, P.last_updated, \nCONCAT(DATE_FORMAT(P.financial_year_start, ''%Y''),''-'',DATE_FORMAT(P.financial_year_end, ''%Y'')) AS financial_year,\n\n(SELECT name FROM organizations WHERE id=P._organization_id LIMIT 1) AS pde, \n\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=P._entered_by LIMIT 1) AS entered_by, \n\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=P._last_updated_by LIMIT 1) AS last_updated_by\n\nFROM procurement_plans P \n\nWHERE id=''_PLAN_ID_'''),
(41, 'update_tender_status', 'UPDATE tender_notices SET status = ''_NEW_STATUS_'' WHERE id IN (''_ID_LIST_'')'),
(42, 'get_currency_list', 'SELECT code AS currency_code, CONCAT(code, '' - '', name) AS display FROM currencies WHERE name LIKE ''%_PHRASE_%'' ORDER BY display_order _LIMIT_TEXT_'),
(43, 'get_my_bid_list', 'SELECT B.id AS bid_id, B.date_submitted, B.summary, B.bid_amount, B.bid_currency, B.final_contract_amount, B.final_amount_currency, B.valid_start_date, B.valid_end_date, B.status, B.last_updated, B._organization_id AS provider_id, B._tender_notice_id AS tender_id, \n\n(SELECT name FROM organizations WHERE id = B._organization_id LIMIT 1) AS provider, \n\n(SELECT O.name FROM tender_notices N LEFT JOIN organizations O ON (N._organization_id=O.id) WHERE N.id=B._tender_notice_id LIMIT 1) AS pde, \n\n(SELECT N._organization_id FROM tender_notices N WHERE N.id=B._tender_notice_id LIMIT 1) AS pde_id, \n\n(SELECT P.title FROM tender_notices N LEFT JOIN procurement_plans P ON (P.id=N._procurement_plan_id) WHERE N.id=B._tender_notice_id LIMIT 1) AS procurement_plan, \n\n(SELECT name FROM tender_notices WHERE id = B._tender_notice_id LIMIT 1) AS tender_notice, \n\n(SELECT GROUP_CONCAT(document_url) FROM bid_documents WHERE _bid_id=B.id) AS documents, \n\n(SELECT GROUP_CONCAT(CONCAT(UPPER(status),'' ('',DATE_FORMAT(date_entered,''%d/%m/%Y''),'' TO '',IF(end_date <> ''0000-00-00'', DATE_FORMAT(end_date,''%d/%m/%Y''),''NOW''),'')'') SEPARATOR ''<BR>'') \nFROM bid_status WHERE _bid_id=B.id ORDER BY date_entered DESC) AS status_trail \n\nFROM bids B \n\nWHERE 1=1 _STATUS_CONDITION_\nHAVING 1=1 _PDE_CONDITION_ _PHRASE_CONDITION_ \nORDER BY B.last_updated DESC \n_LIMIT_TEXT_'),
(44, 'add_bid_record', 'INSERT INTO bids (_organization_id, _submitted_by, date_submitted, _tender_notice_id, bid_amount, bid_currency, summary, valid_start_date, valid_end_date, status, last_updated)\r\n\r\n(SELECT ''_ORGANIZATION_ID_'' AS _organization_id, IF(''_STATUS_''=''submitted'', ''_USER_ID_'', '''') AS _submitted_by, IF(''_STATUS_''=''submitted'', NOW(), ''0000-00-00'') AS date_submitted, ''_TENDER_ID_'' AS _tender_notice_id, ''_BID_AMOUNT_'' AS bid_amount, ''_BID_CURRENCY_'' AS bid_currency, ''_SUMMARY_'' AS summary, ''_VALID_START_DATE_'' AS valid_start_date, ''_VALID_END_DATE_'' AS valid_end_date, ''_STATUS_'' AS status, NOW() AS last_updated )'),
(45, 'add_bid_status', 'INSERT IGNORE INTO bid_status (_bid_id, status, date_entered, _entered_by) VALUES (''_BID_ID_'', ''_STATUS_'', NOW(), ''_USER_ID_'')'),
(46, 'add_bid_document', 'INSERT INTO bid_documents (_bid_id, document_url, date_entered, _entered_by, last_updated, 	_last_updated_by) VALUES (''_BID_ID_'', ''_DOCUMENT_URL_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')'),
(47, 'get_basic_bid', 'SELECT * FROM bids WHERE id=''_BID_ID_'''),
(48, 'update_status_trail', 'UPDATE bid_status SET end_date=NOW() WHERE (end_date=''0000-00-00 00:00:00'' OR DATE(end_date) > NOW()) AND _bid_id IN (''_BID_IDS_'')'),
(49, 'add_status_trail', 'INSERT INTO bid_status (_bid_id, status, date_entered, _entered_by)\n\n(SELECT B.id AS _bid_id, ''_NEW_STATUS_'' AS status, NOW() AS date_entered, ''_USER_ID_'' AS _entered_by FROM bids B WHERE id IN (''_BID_IDS_''))'),
(50, 'update_bid_status', 'UPDATE bids SET status=''_NEW_STATUS_'', last_updated=NOW() WHERE id IN (''_BID_IDS_'')'),
(51, 'submit_provider_bid', 'UPDATE bids SET status=''submitted'', last_updated=NOW(), _submitted_by=''_USER_ID_'', date_submitted=NOW() WHERE id IN (''_BID_IDS_'')'),
(52, 'get_bid_provider_users', 'SELECT U.id AS user_id FROM bids B LEFT JOIN users U ON (U._organization_id=B._organization_id) \nWHERE B.id = ''_BID_ID_'' AND U.id IS NOT NULL'),
(53, 'get_contract_list', 'SELECT C.id AS contract_id, C._tender_id AS tender_id, C.name, C.contract_currency, C.contract_amount, C.progress_percent, C.date_started, C.status, C.last_updated,\r\n\r\n(SELECT name FROM organizations WHERE id = C._organization_id LIMIT 1) AS provider, \r\n\r\n(SELECT O.name FROM tender_notices N LEFT JOIN organizations O ON (N._organization_id=O.id) WHERE N.id=C._tender_id LIMIT 1) AS pde,\r\n\r\n(SELECT N._organization_id FROM tender_notices N WHERE N.id=C._tender_id LIMIT 1) AS pde_id,\r\n\r\n(SELECT N.name FROM tender_notices N WHERE N.id=C._tender_id LIMIT 1) AS tender_notice,\r\n\r\nIF((SELECT id FROM contract_status WHERE _contract_id=C.id LIMIT 1) IS NOT NULL, ''Y'', ''N'') AS has_notes,\r\n\r\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=C._last_updated_by LIMIT 1) AS last_updated_by, \r\n\r\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS \r\nWHERE CS._contract_id=C.id AND CS.status=''commenced'' ORDER BY CS.date_entered LIMIT 1), \r\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS \r\nWHERE CS._contract_id=C.id AND CS.status=''active'' ORDER BY CS.date_entered LIMIT 1), '''')) AS date_commenced, \r\n\r\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS \r\nWHERE CS._contract_id=C.id AND CS.status=''active'' ORDER BY CS.date_entered LIMIT 1), '''') AS date_signed\r\n\r\nFROM contracts C \r\nWHERE 1=1 _TENDER_CONDITION_ _PDE_CONDITION_ _STATUS_CONDITION_ _OWNER_CONDITION_ _PHRASE_CONDITION_ \r\n\r\nORDER BY last_updated DESC \r\n _LIMIT_TEXT_'),
(54, 'search_tender_list', 'SELECT id AS tender_id, name, winner_bid_price, winner_bid_currency, \n(SELECT _organization_id FROM contracts WHERE _tender_id=T.id LIMIT 1) AS provider_id\n\nFROM tender_notices T WHERE name LIKE ''%_PHRASE_%'' _OWNER_CONDITION_ _LIMIT_TEXT_'),
(55, 'add_contract_record', 'INSERT INTO contracts (_tender_id, _organization_id, _pde_id, name, contract_currency, contract_amount, source_of_funds, date_started, status, 	date_entered, _entered_by, last_updated, _last_updated_by) VALUES \n(''_TENDER_ID_'', ''_ORGANIZATION_ID_'', ''_PDE_ID_'', ''_NAME_'', ''_CONTRACT_CURRENCY_'', ''_CONTRACT_AMOUNT_'', ''_SOURCE_OF_FUNDS_'', ''_DATE_STARTED_'', ''_STATUS_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')'),
(56, 'add_contract_status', 'INSERT INTO contract_status (_contract_id, percentage, status, amount_spent, amount_paid, document_urls, notes, date_entered, _entered_by, _entered_by_organization_id) VALUES \n(''_CONTRACT_ID_'', ''_PERCENTAGE_'', ''_STATUS_'', ''_AMOUNT_SPENT_'', ''_AMOUNT_PAID_'', ''_DOCUMENT_URL_'', ''_NOTES_'', NOW(), ''_USER_ID_'', ''_ORGANIZATION_ID_'')'),
(57, 'update_bid_contract_amount', 'UPDATE bids SET final_contract_amount=''_CONTRACT_AMOUNT_'', final_amount_currency=''_CONTRACT_CURRENCY_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE _tender_notice_id=''_TENDER_ID_'' AND _organization_id=''_ORGANIZATION_ID_''\r\n'),
(58, 'get_contract_notes', 'SELECT status, percentage, amount_spent, amount_paid, document_urls AS documents, notes, date_entered, \n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=CS._entered_by LIMIT 1) AS entered_by,\n(SELECT name FROM organizations WHERE id=CS._entered_by_organization_id LIMIT 1) AS entered_by_organization\n\nFROM contract_status CS \nWHERE _contract_id=''_CONTRACT_ID_''\nORDER BY date_entered DESC \n \n_LIMIT_TEXT_'),
(59, 'update_contract_percentage', 'UPDATE contracts SET progress_percent=''_PERCENTAGE_'', status=''_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id=''_CONTRACT_ID_'''),
(60, 'get_document_list', 'SELECT id AS document_id, url, size, tracking_number, name, description, document_type, category, is_removable, date_entered, status,  \n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=D._entered_by LIMIT 1) AS entered_by,\n(SELECT name FROM organizations WHERE id=D._entered_by_organization LIMIT 1) AS entered_by_organization\n\nFROM documents D WHERE 1=1 _CATEGORY_CONDITION_ _PHRASE_CONDITION_ _TYPE_CONDITION_ _STATUS_CONDITION_ _OWNER_CONDITION_  \nORDER BY status ASC, date_entered DESC  \n _LIMIT_TEXT_ '),
(61, 'add_document_record', 'INSERT INTO documents (url, size, tracking_number, name, description, document_type, category, 	is_removable, parent_id, parent_type, date_entered, _entered_by, _entered_by_organization, last_updated, _last_updated_by) VALUES \n(''_URL_'', ''_SIZE_'', ''_TRACKING_NUMBER_'', ''_NAME_'', ''_DESCRIPTION_'', ''_DOCUMENT_TYPE_'', ''_CATEGORY_'', ''_IS_REMOVABLE_'', ''_PARENT_ID_'', ''_PARENT_TYPE_'', NOW(), ''_USER_ID_'', ''_ORGANIZATION_ID_'', NOW(), ''_USER_ID_'')'),
(62, 'delete_document_record', 'DELETE FROM documents WHERE id IN (''_DOCUMENT_IDS_'')'),
(63, 'update_document_status', 'UPDATE documents SET status=''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_DOCUMENT_IDS_'')'),
(64, 'get_link_list', 'SELECT id AS link_id, url, name, open_type, status, date_entered, \n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=L._entered_by LIMIT 1) AS entered_by, \n(SELECT name FROM organizations WHERE id=L._entered_by_organization LIMIT 1) AS entered_by_organization\nFROM links L WHERE 1=1 _OWNER_CONDITION_ _STATUS_CONDITION_ _OPEN_CONDITION_  _PHRASE_CONDITION_ \nORDER BY status ASC, date_entered DESC \n_LIMIT_TEXT_'),
(65, 'add_link_record', 'INSERT INTO links (url, name, open_type, date_entered, _entered_by, _entered_by_organization, last_updated, _last_updated_by) \r\nVALUES \r\n(''_URL_'', ''_NAME_'', ''_OPEN_TYPE_'', NOW(), ''_USER_ID_'', ''_ORGANIZATION_ID_'', NOW(), ''_USER_ID_'')'),
(66, 'delete_link_record', 'DELETE FROM links WHERE id IN (''_LINK_IDS_'')'),
(67, 'update_link_status', 'UPDATE links SET status=''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_LINK_IDS_'')'),
(68, 'get_training_list', 'SELECT id AS training_id, subject, category, description, duration, event_time, venue, url, documents, date_entered, status, \r\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=T._entered_by LIMIT 1) AS entered_by, \r\n(SELECT name FROM organizations WHERE id=T._entered_by_organization LIMIT 1) AS entered_by_organization\r\n\r\nFROM training T WHERE 1=1 _PHRASE_CONDITION_ _STATUS_CONDITION_ _CATEGORY_CONDITION_ _OWNER_CONDITION_ \r\nORDER BY status ASC, date_entered DESC \r\n_LIMIT_TEXT_'),
(69, 'add_training_record', 'INSERT INTO training (subject, category, description, duration, event_time, venue, url, documents, date_entered, _entered_by, _entered_by_organization, last_updated, _last_updated_by) \r\nVALUES \r\n(''_SUBJECT_'', ''_CATEGORY_'', ''_DESCRIPTION_'', ''_DURATION_'', ''_EVENT_TIME_'', ''_VENUE_'', ''_URL_'', ''_DOCUMENTS_'', NOW(), ''_USER_ID_'', ''_ORGANIZATION_ID_'', NOW(), ''_USER_ID_'')'),
(70, 'delete_training_record', 'DELETE FROM training WHERE id IN (''_TRAINING_IDS_'')'),
(71, 'update_training_status', 'UPDATE training SET status=''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_TRAINING_IDS_'')'),
(72, 'update_user_settings', 'UPDATE users SET \r\nphoto_url = IF(''_PHOTO_URL_'' <> '''', ''_PHOTO_URL_'', photo_url), \r\npassword = IF(''_PASSWORD_'' <> '''', ''_PASSWORD_'', password), \r\ntelephone = ''_TELEPHONE_'', \r\notherphone = ''_OTHERPHONE_'', \r\nsecret_question = (SELECT question FROM secret_questions WHERE id = ''_SECRET_QUESTION_ID_'' LIMIT 1), \r\nsecret_answer = ''_SECRET_ANSWER_'', \r\naddress_line_1 = ''_ADDRESS_LINE_1_'', \r\ncity = ''_CITY_'', \r\nstate = ''_STATE_'', \r\nzipcode = ''_ZIPCODE_'', \r\ncountry = ''_COUNTRY_'', \r\nlast_updated = NOW(), \r\n_last_updated_by = ''_USER_ID_''\r\n\r\nWHERE id=''_USER_ID_'''),
(73, 'update_organization_settings', 'UPDATE organizations SET \r\nlogo_url= IF(''_LOGO_URL_'' <> '''', ''_LOGO_URL_'', logo_url), \r\nname = ''_NAME_'', \r\ndescription = ''_DESCRIPTION_'',\r\ncontact_address = ''_CONTACT_ADDRESS_'', \r\ncontact_city = ''_CONTACT_CITY_'', \r\ncontact_region = ''_CONTACT_REGION_'', \r\ncontact_zipcode = ''_CONTACT_ZIPCODE_'', \r\ncontact_country_id = ''_CONTACT_COUNTRY_ID_'',\r\n_registration_country_id = IF(''_REGISTRATION_COUNTRY_ID_'' <> '''', ''_REGISTRATION_COUNTRY_ID_'', _registration_country_id),  \r\nregistration_number = IF(''_REGISTRATION_NUMBER_'' <> '''', ''_REGISTRATION_NUMBER_'', registration_number),\r\ndate_established = IF(''_DATE_ESTABLISHED_'' <> '''', ''_DATE_ESTABLISHED_'', date_established), \r\nlast_updated=NOW(),\r\n_last_updated_by=''_USER_ID_''\r\n\r\nWHERE id=''_ORGANIZATION_ID_'''),
(74, 'get_permission_group_list', 'SELECT id AS group_id, name, notes, is_removable, type, date_added AS date_created, \n(SELECT COUNT(id) FROM permission_group_mapping WHERE _group_id=G.id) AS no_of_permissions, \n(SELECT COUNT(id) FROM users WHERE _permission_group_id=G.id) AS no_of_users\n\nFROM permission_groups G \nWHERE 1=1 _TYPE_CONDITION_ _PHRASE_CONDITION_ \n\n_LIMIT_TEXT_'),
(75, 'update_group_details', 'UPDATE permission_groups SET name=''_NAME_'', notes=''_NOTES_'', _default_permission=''_DEFAULT_PERMISSION_'', type=''_TYPE_'', last_updated = NOW(), last_updated_by = ''_USER_ID_''\n\nWHERE id=''_GROUP_ID_'''),
(76, 'add_permission_group', 'INSERT INTO permission_groups (name, notes, _default_permission, type,  is_removable, is_system_only, date_added, added_by, last_updated, last_updated_by) VALUES \n(''_NAME_'', ''_NOTES_'', ''_DEFAULT_PERMISSION_'', ''_TYPE_'', ''Y'', ''N'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')'),
(77, 'remove_group_permissions', 'DELETE FROM permission_group_mapping WHERE _group_id=''_GROUP_ID_'''),
(78, 'add_group_permissions', 'INSERT INTO permission_group_mapping ( _group_id, _permission_id, date_added, added_by )\r\n\r\n(SELECT ''_GROUP_ID_'' AS _group_id, P.id AS _permission_id, NOW() AS date_added, ''_USER_ID_'' AS added_by FROM permissions P WHERE id IN (''_PERMISSION_IDS_''))'),
(79, 'get_group_permissions', 'SELECT P.id AS permission_id, P.category, P.display AS name FROM permission_group_mapping PM LEFT JOIN permissions P ON (PM._permission_id=P.id) WHERE PM._group_id=''_GROUP_ID_'' ORDER BY P.category'),
(80, 'get_system_permissions', 'SELECT id AS permission_id, display AS name, category FROM permissions WHERE status=''active'' ORDER BY category ASC'),
(81, 'delete_permission_group', 'DELETE FROM permission_groups WHERE id IN (_GROUP_IDS_)'),
(82, 'delete_group_mapping', 'DELETE FROM permission_group_mapping WHERE _group_id IN (_GROUP_IDS_)'),
(83, 'get_faq_list', 'SELECT id AS faq_id, question, answer, status, date_entered, \n(SELECT id FROM faqs WHERE display_order = (F.display_order - 1) LIMIT 1) AS show_after, \n(SELECT question FROM faqs WHERE display_order = (F.display_order - 1) LIMIT 1) AS show_after_question   \n\nFROM faqs F \nWHERE 1=1 _OWNER_CONDITION_ _STATUS_CONDITION_ _PHRASE_CONDITION_ \nORDER BY status, display_order \n_LIMIT_TEXT_'),
(84, 'update_faq_details', 'UPDATE faqs SET question=''_QUESTION_'', answer=''_ANSWER_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' \r\nWHERE id=''_FAQ_ID_'''),
(85, 'add_faq_record', 'INSERT INTO faqs (question, answer, display_order,  date_entered, _entered_by, _entered_by_organization, last_updated, _last_updated_by) \n\n(SELECT ''_QUESTION_'' AS question, ''_ANSWER_'' AS answer, (SELECT (MAX(display_order) + 1) FROM faqs) AS display_order, \nNOW() AS date_entered, ''_USER_ID_'' AS _entered_by, ''_ORGANIZATION_ID_'' AS _entered_by_organization, NOW() AS last_updated, ''_USER_ID_'' AS _last_updated_by)'),
(86, 'delete_faq_record', 'DELETE FROM faqs WHERE id IN (''_FAQ_IDS_'')'),
(87, 'update_faq_status', 'UPDATE faqs SET status=''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_FAQ_IDS_'')'),
(88, 'update_faq_display_order', 'UPDATE faqs F, \n(SELECT (SELECT display_order FROM faqs WHERE id=''_SHOW_AFTER_'' LIMIT 1) AS reference_item_order\n) A \nSET F.display_order = IF(id=''_NEW_FAQ_'', (A.reference_item_order + 1), (F.display_order + 1))\nWHERE F.display_order > A.reference_item_order'),
(89, 'search_simple_faq_list', 'SELECT id AS faq_id, question FROM faqs WHERE question LIKE ''%_PHRASE_%'' _LIMIT_TEXT_'),
(90, 'get_forum_list', 'SELECT id AS forum_id, topic, details, status, document_url, no_of_views, no_of_contributors, category, is_public, date_entered, last_updated, _moderator_id AS moderator_id, \n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=F._entered_by LIMIT 1) AS entered_by, \n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=F._last_updated_by LIMIT 1) AS last_updated_by,\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=F._moderator_id LIMIT 1) AS moderator, \n(SELECT name FROM organizations WHERE id=F._entered_by_organization LIMIT 1) AS entered_by_organization\n\nFROM forums F \nWHERE 1=1 _PHRASE_CONDITION_ _STATUS_CONDITION_ _ACCESS_CONDITION_ _OWNER_CONDITION_ _ACCESS_CONDITION_ _CATEGORY_CONDITION_ \n\nORDER BY status, topic \n_LIMIT_TEXT_'),
(91, 'update_forum_record', 'UPDATE forums SET topic=''_TOPIC_'', details=''_DETAILS_'', \ndocument_url=IF(''_DOCUMENT_URL_'' <> '''', ''_DOCUMENT_URL_'', document_url), \ncategory=''_CATEGORY_'', is_public=''_IS_PUBLIC_'', _moderator_id=''_MODERATOR_'', last_updated=NOW(), _last_updated_by=''_USER_ID_''\n\nWHERE id = ''_FORUM_ID_'''),
(92, 'add_forum_record', 'INSERT INTO forums (topic, details, document_url, category, is_public, _moderator_id, date_entered, _entered_by, _entered_by_organization, last_updated, _last_updated_by) \nVALUES \n(''_TOPIC_'', ''_DETAILS_'',''_DOCUMENT_URL_'', ''_CATEGORY_'', ''_IS_PUBLIC_'', ''_MODERATOR_'', NOW(), ''_USER_ID_'', ''_ORGANIZATION_ID_'', NOW(), ''_USER_ID_'')'),
(93, 'get_procurement_categories', 'SELECT id, name FROM procurement_categories'),
(94, 'get_most_active_pde', 'SELECT DISTINCT _organization_id AS pde_id, \n(SELECT name FROM organizations WHERE id=N._organization_id) AS name, \n(SELECT COUNT(*) FROM tender_notices WHERE DATE(deadline) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_'') AND _organization_id=N._organization_id) AS tender_count \nFROM tender_notices N \nORDER BY tender_count\n_LIMIT_TEXT_'),
(95, 'get_procurement_plan_tracking_report_data', 'SELECT DATA.category, DATA.tender_id, DATA.brief_description, DATA.procurement_method, DATA.ssp_estimate, DATA.plan_or_actual, DATA.rfp_status, \nDATA.bid_open_status, DATA.bid_short_list_status, DATA.issuance_of_rfp_status, DATA.receipt_of_rfp_status, DATA.evaluation_status, \nDATA.contract_approval_status, DATA.contract_endorsement_status, DATA.contract_award_status, DATA.contract_commencement_status, \nDATA.contract_completion_status FROM \n\n(\n(SELECT N.id AS tender_id, N.deadline, \n\n(SELECT B FROM procurement_plan_details WHERE A = SUBSTRING_INDEX(PD.A, ''.'', 1 ) LIMIT 1) AS category, \n\nPD.B AS brief_description,\n\nPD.C AS procurement_method,\n\nPD.D AS ssp_estimate,\n\n''Plan'' AS plan_or_actual, \n\nPD.E AS rfp_status,\n\nPD.F AS bid_open_status, \n\nPD.G AS bid_short_list_status,\n \nPD.H AS issuance_of_rfp_status, \n\nPD.I AS receipt_of_rfp_status, \n\nPD.J AS evaluation_status, \n\nPD.K AS contract_approval_status, \n\nPD.L AS contract_endorsement_status, \n\nPD.M AS contract_award_status, \n\nPD.N AS contract_commencement_status, \n\nPD.O AS contract_completion_status\n\nFROM tender_notices N LEFT JOIN procurement_plan_details PD ON (N.subject_id=PD.id)\nWHERE PD.id IS NOT NULL AND N._organization_id=''_PDE_'' AND DATE(N.display_start_date) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_''))\n\n\n\nUNION \n\n\n\n(SELECT N.id AS tender_id, N.deadline,  \n\n(SELECT name FROM procurement_categories WHERE id=N._category_id LIMIT 1) AS category, \n\nN.name AS brief_description,\n\ncap_first_letter_in_words(REPLACE(N.method,''_'','' '')) AS procurement_method,\n\nIFNULL((SELECT SUM(CS.amount_spent) FROM contract_status CS LEFT JOIN contracts C ON (CS._contract_id=C.id) WHERE C._tender_id=N.id AND CS.amount_spent > 0), \n	IFNULL((SELECT B.bid_amount * (SELECT exchange_rate FROM currencies WHERE code=B.bid_currency LIMIT 1) \n		FROM bids B WHERE B._tender_notice_id = N.id AND status IN (''won'',''awarded'',''complete'',''archived'') ORDER BY last_updated DESC LIMIT 1), ''0'')\n) AS ssp_estimate,\n\n''Actual'' AS plan_or_actual, \n\nIFNULL((SELECT IF(display_start_date <> ''0000-00-00'', DATE_FORMAT(display_start_date, ''%d/%m/%Y''), ''NONE'') \n	FROM tender_notices \n	WHERE id=N.id LIMIT 1), ''NONE'') AS rfp_status,\n\nIFNULL((SELECT DATE_FORMAT(BS.date_entered, ''%d/%m/%Y'') FROM bid_status BS LEFT JOIN bids B ON (BS._bid_id=B.id) \n	WHERE B._tender_notice_id=N.id AND BS.status=''under_review''  \n	ORDER BY BS.date_entered LIMIT 1), ''NONE'') AS bid_open_status, \n\nIFNULL((SELECT DATE_FORMAT(BS.date_entered, ''%d/%m/%Y'') FROM bid_status BS LEFT JOIN bids B ON (BS._bid_id=B.id) \n	WHERE B._tender_notice_id=N.id AND BS.status=''short_list''  \n	ORDER BY BS.date_entered LIMIT 1), ''NONE'') AS bid_short_list_status, \n\nIFNULL((SELECT IF(display_start_date <> ''0000-00-00'', DATE_FORMAT(display_start_date, ''%d/%m/%Y''), ''NONE'') \n	FROM tender_notices \n	WHERE id=N.id AND type=''services'' LIMIT 1), ''NONE'') AS issuance_of_rfp_status, \n\nIFNULL((SELECT DATE_FORMAT(BS.date_entered, ''%d/%m/%Y'') FROM bid_status BS LEFT JOIN bids B ON (BS._bid_id=B.id) \n	WHERE B._tender_notice_id=N.id AND BS.status=''submitted''  \n	ORDER BY BS.date_entered LIMIT 1), ''NONE'') AS receipt_of_rfp_status, \n\nIFNULL((SELECT DATE_FORMAT(BS.date_entered, ''%d/%m/%Y'') FROM bid_status BS LEFT JOIN bids B ON (BS._bid_id=B.id) \n	WHERE B._tender_notice_id=N.id AND BS.status=''won''  \n	ORDER BY BS.date_entered LIMIT 1), ''NONE'') AS evaluation_status, \n\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS LEFT JOIN contracts C ON (CS._contract_id=C.id) \n	WHERE C._tender_id=N.id AND CS.status=''active''  \n	ORDER BY CS.date_entered LIMIT 1), ''NONE'') AS contract_approval_status, \n\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS LEFT JOIN contracts C ON (CS._contract_id=C.id) \n	WHERE C._tender_id=N.id AND CS.status=''endorsed''  \n	ORDER BY CS.date_entered LIMIT 1), ''NONE'') AS contract_endorsement_status, \n\nIFNULL((SELECT DATE_FORMAT(BS.date_entered, ''%d/%m/%Y'') FROM bid_status BS LEFT JOIN bids B ON (BS._bid_id=B.id) \n	WHERE B._tender_notice_id=N.id AND BS.status=''awarded''  \n	ORDER BY BS.date_entered DESC LIMIT 1), ''NONE'') AS contract_award_status, \n\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS LEFT JOIN contracts C ON (CS._contract_id=C.id) \n	WHERE C._tender_id=N.id AND CS.status=''commenced''  \n	ORDER BY CS.date_entered LIMIT 1), ''NONE'') AS contract_commencement_status, \n\nIFNULL((SELECT DATE_FORMAT(CS.date_entered, ''%d/%m/%Y'') FROM contract_status CS LEFT JOIN contracts C ON (CS._contract_id=C.id) \n	WHERE C._tender_id=N.id AND CS.status IN (''complete'',''terminated'',''final_payment'') \n	ORDER BY CS.date_entered LIMIT 1), ''NONE'') AS contract_completion_status\n\nFROM tender_notices N \nWHERE N._organization_id=''_PDE_'' AND DATE(N.display_start_date) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_''))\n) DATA \n\nORDER BY DATA.tender_id ASC, DATA.plan_or_actual DESC, DATA.deadline ASC '),
(96, 'update_organization_status', 'UPDATE organizations SET status = ''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_ID_LIST_'')'),
(97, 'update_user_status_by_organization_ids', 'UPDATE users SET status = ''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE _organization_id IN (''_ID_LIST_'')'),
(98, 'get_users_in_organizations', 'SELECT id AS user_id, email_address FROM users WHERE _organization_id IN (''_ORGANIZATION_IDS_'')'),
(99, 'get_pde_categories', 'SELECT id, name FROM pde_categories'),
(100, 'get_procurements_in_progress_report_data', 'SELECT N.id, N.reference_number AS procurement_number, \n\nN.name AS subject_of_procurement, \n\ncap_first_letter_in_words(REPLACE(N.method, ''_'','' '')) AS procurement_method, \n\nIFNULL((SELECT source_of_funds FROM contracts WHERE _tender_id=N.id LIMIT 1),''UNSPECIFIED'') AS source_of_funds, \n\nIF((SELECT id FROM bids WHERE _tender_notice_id = N.id AND status  IN (''awarded'',''won'',''complete'') LIMIT 1) IS NOT NULL, ''Contract Award'', \nIF((SELECT id FROM bids WHERE _tender_notice_id = N.id AND status =''short_list'' LIMIT 1) IS NOT NULL, ''Bid/EOI Evaluation/Short List'', \nIF((SELECT id FROM bids WHERE _tender_notice_id = N.id AND status =''under_review'' LIMIT 1) IS NOT NULL, ''Bid/EOI Invitation & Open'', \n''Request For Proposals''\n))) AS approval_given_for,\n\nIFNULL((SELECT DATE_FORMAT(MIN(last_updated),''%d/%m/%Y'') FROM bids WHERE _tender_notice_id = N.id AND status IN (''awarded'',''won'',''complete'')),\nIFNULL((SELECT DATE_FORMAT(MIN(last_updated),''%d/%m/%Y'') FROM bids WHERE _tender_notice_id = N.id AND status =''short_list''),\nIFNULL((SELECT DATE_FORMAT(MIN(last_updated),''%d/%m/%Y'') FROM bids WHERE _tender_notice_id = N.id AND status =''under_review''),\nDATE_FORMAT(N.last_updated,''%d/%m/%Y'')\n))) AS date_of_approval,\n\nN.budget_amount AS estimated_contract_value\n\nFROM tender_notices N \nWHERE N._organization_id=''_PDE_'' AND DATE(N.deadline) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_'') AND N.status <> ''saved'''),
(101, 'get_contracts_signed_report_data', 'SELECT DATA.* FROM \n(SELECT \n@successful_bid := (SELECT BS._bid_id FROM bid_status BS LEFT JOIN bids B ON (B.id=BS._bid_id) \nWHERE BS.status=''awarded'' AND B._tender_notice_id=N.id AND BS._bid_id IS NOT NULL ORDER BY BS.date_entered DESC LIMIT 1),\n\nN.reference_number AS procurement_number, \n\nN.name AS subject_of_procurement, \n\n(SELECT O.name FROM organizations O LEFT JOIN bids B ON (O.id=B._organization_id) WHERE B.id=@successful_bid LIMIT 1) AS successful_supplier_or_contractor, \n\nIFNULL((SELECT source_of_funds FROM contracts WHERE _tender_id=N.id LIMIT 1),''UNSPECIFIED'') AS source_of_funds, \n\n(SELECT  DATE_FORMAT(BS.date_entered,''%d/%m/%Y'') FROM bid_status BS WHERE BS.status=''awarded'' AND BS._bid_id=@successful_bid ORDER BY BS.date_entered DESC LIMIT 1) AS date_of_award,\n\n(SELECT DATE_FORMAT(CS.date_entered,''%d/%m/%Y'') FROM contract_status CS LEFT JOIN contracts C ON (CS._contract_id=C.id) \nWHERE CS.status=''active'' AND C._tender_id=N.id ORDER BY CS.date_entered ASC LIMIT 1) AS date_contract_signed,\n\n(SELECT contract_amount FROM contracts WHERE _tender_id=N.id LIMIT 1) AS contract_value\n\nFROM tender_notices N \nWHERE N._organization_id=''_PDE_ID_'' AND DATE(N.deadline) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_'') AND N.status <> ''saved'' \n) DATA \nWHERE DATA.date_of_award IS NOT NULL'),
(102, 'get_procurements_completed_report_data', 'SELECT N.reference_number AS procurement_number,\n \nN.name AS subject_of_procurement, \n\n(SELECT name FROM organizations WHERE id=C._organization_id LIMIT 1) AS supplier_or_contractor, \n\nIFNULL((SELECT source_of_funds FROM contracts WHERE _tender_id=N.id LIMIT 1),''UNSPECIFIED'') AS source_of_funds, \n\n@status_id := IFNULL((SELECT id FROM contract_status WHERE status=''terminated'' AND _contract_id=C.id ORDER BY date_entered DESC LIMIT 1), \n	(SELECT id FROM contract_status WHERE status=''complete'' AND _contract_id=C.id ORDER BY date_entered DESC LIMIT 1)), \n\n(SELECT DATE_FORMAT(date_entered,''%d/%m/%Y'') FROM contract_status WHERE id=@status_id LIMIT 1) AS date_of_completion, \n\nIF((SELECT status FROM contract_status WHERE id=@status_id) = ''terminated'', \nCONCAT(''TERMINATED: '',(SELECT notes FROM contract_status WHERE id=@status_id)), \nIF((SELECT status FROM contract_status WHERE id=@status_id) = ''cancelled'', \nCONCAT(''CANCELLED: '',(SELECT notes FROM contract_status WHERE id=@status_id)), \nCONCAT(''COMPLETED: '',(SELECT notes FROM contract_status WHERE id=@status_id)) \n)) AS date_reason, \n\nIFNULL((SELECT DATE_FORMAT(date_entered,''%d/%m/%Y'') FROM contract_status \nWHERE status=''final_payment'' AND _contract_id=C.id ORDER BY date_entered DESC LIMIT 1), ''PENDING'') AS date_of_final_payment, \n\n(SELECT SUM(amount_paid) FROM contract_status WHERE _contract_id=C.id) AS total_amount_paid\n\nFROM contracts C \nLEFT JOIN tender_notices N ON (N.id=C._tender_id)\nWHERE C._pde_id=''_PDE_ID_'' AND DATE(C.date_entered) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_'') \nAND (SELECT id FROM contract_status WHERE status IN (''complete'',''terminated'',''cancelled'') AND _contract_id=C.id LIMIT 1) IS NOT NULL; \n'),
(103, 'get_low_value_procurements_report_data', 'SELECT N.reference_number AS procurement_number, \n\nN.name AS subject_of_procurement, \n\n(SELECT name FROM organizations WHERE id=C._organization_id LIMIT 1) AS supplier_or_contractor, \n\ncap_first_letter_in_words(REPLACE(N.method, ''_'','' '')) AS procurement_method,\n\nDATE_FORMAT(C.date_entered,''%d/%m/%Y'') AS date_of_contract,\n\nC.contract_amount AS contract_value\n\nFROM contracts C \nLEFT JOIN tender_notices N ON (N.id=C._tender_id)\n\nWHERE C._pde_id=''_PDE_ID_'' AND DATE(C.date_entered) BETWEEN DATE(''_START_DATE_'') AND DATE(''_END_DATE_'') \nAND ((N.type=''goods'' AND C.contract_amount <= 25000) OR (N.type=''works'' AND C.contract_amount <= 50000) OR (N.type=''services'' AND C.contract_amount <= 10000))'),
(104, 'update_procurement_plan_status', 'UPDATE procurement_plans SET status = ''_NEW_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_ID_LIST_'')'),
(105, 'search_provider_list', 'SELECT O.id AS provider_id, O.name, O.name AS provider \r\nFROM organizations O LEFT JOIN users U ON (O._owner_user_id=U.id) LEFT JOIN permission_groups G ON (U._permission_group_id=G.id) \r\n\r\nWHERE G.type = ''provider'' AND O.name LIKE ''%_PHRASE_%'' _LIMIT_TEXT_'),
(106, 'get_users_in_bid_organizations', 'SELECT id AS user_id, email_address FROM users \nWHERE _organization_id IN (SELECT DISTINCT _organization_id FROM bids WHERE id IN (''_BID_IDS_''))');
INSERT INTO `queries` (`id`, `code`, `details`) VALUES
(107, 'get_bid_details_by_tender', 'SELECT B.id AS bid_id, B.summary, B.bid_currency, B.bid_amount, B.valid_start_date, B.valid_end_date, B.status, \r\n(SELECT GROUP_CONCAT(document_url) FROM bid_documents WHERE _bid_id=B.id) AS documents\r\n\r\nFROM bids B \r\nWHERE B._tender_notice_id=''_TENDER_ID_'' AND B._organization_id=''_ORGANIZATION_ID_'''),
(108, 'update_bid_record', 'UPDATE bids SET \r\n_submitted_by = (SELECT IF(''_STATUS_''=''submitted'', ''_USER_ID_'', '''')), \r\ndate_submitted = (SELECT IF(''_STATUS_''=''submitted'', NOW(), ''0000-00-00'')), \r\nbid_amount = ''_BID_AMOUNT_'', \r\nbid_currency = ''_BID_CURRENCY_'', \r\nsummary = ''_SUMMARY_'', \r\nvalid_start_date = ''_VALID_START_DATE_'', \r\nvalid_end_date = ''_VALID_END_DATE_'', \r\nstatus=''_STATUS_'', \r\nlast_updated=NOW(), \r\n_last_updated_by=''_USER_ID_''\r\n\r\nWHERE id=''_BID_ID_'''),
(109, 'remove_bid_documents', 'DELETE FROM bid_documents WHERE _bid_id=''_BID_ID_'''),
(110, 'get_pde_stats', 'SELECT \n(SELECT COUNT(*) FROM procurement_plans \nWHERE _organization_id = ''_PDE_ID_'' AND DATE(financial_year_start) <= DATE(''_START_DATE_'') AND DATE(financial_year_end) >= DATE(''_END_DATE_'') AND status=''published'') AS plans_submitted,\n\n(SELECT COUNT(*) FROM tender_notices \nWHERE _organization_id = ''_PDE_ID_'' AND DATE(display_start_date) >= DATE(''_START_DATE_'') AND DATE(display_start_date) <= DATE(''_END_DATE_'') AND status=''published'') AS tenders_advertised, \n\n(SELECT COUNT(*) FROM contracts \nWHERE _pde_id = ''_PDE_ID_'' AND DATE(date_started) >= DATE(''_START_DATE_'') AND DATE(date_started) <= DATE(''_END_DATE_'')) AS contracts_awarded'),
(111, 'add_forum_comment', 'INSERT INTO forum_comments (_forum_id, comment, _responding_to, date_added, entered_by) VALUES \n(''_FORUM_ID_'', ''_COMMENT_'', ''_RESPONDING_TO_'', NOW(), ''_USER_ID_'')'),
(112, 'update_contributor_number', 'UPDATE forums F SET \r\nno_of_contributors = (SELECT COUNT(DISTINCT _entered_by) FROM forum_comments WHERE _forum_id=F.id) \r\nWHERE id=''_FORUM_ID_'''),
(113, 'get_forum_comments', 'SELECT id AS comment_id, _forum_id AS forum_id, comment, date_added, _responding_to AS parent_comment_id, \nIF(C.entered_by LIKE ''anonymous_%'', ''Anonymous'', (SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=C.entered_by LIMIT 1)) AS entered_by,\n\n(SELECT _entered_by_organization FROM forums WHERE id=C._forum_id) AS entered_by_organization \n\nFROM forum_comments C \nWHERE C._forum_id=''_FORUM_ID_'' \nORDER BY C.date_added DESC  '),
(114, 'update_no_of_forum_views', 'UPDATE forums SET no_of_views = (no_of_views + 1) WHERE id=''_FORUM_ID_'''),
(115, 'update_provider_certificate', 'UPDATE organizations SET rop_number=''_ROP_NUMBER_'', rop_certificate_url=''_ROP_CERTIFICATE_URL_'', registration_fee=''_REGISTRATION_FEE_'', expiry_date=''_EXPIRY_DATE_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id=''_ORGANIZATION_ID_'''),
(116, 'update_contract_status', 'UPDATE contracts SET status=''_NEW_STATUS_'', last_updated = NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_ID_LIST_'')'),
(117, 'add_automatic_contract_status', 'INSERT INTO contract_status (_contract_id, percentage, amount_spent, amount_paid, status, document_urls, notes, date_entered, _entered_by, _entered_by_organization_id)\n\n(SELECT C.id AS _contract_id, C.progress_percent AS percentage, \nIFNULL((SELECT amount_spent FROM contract_status WHERE _contract_id = C.id ORDER BY date_entered DESC LIMIT 1),0) AS amount_spent, \nIFNULL((SELECT amount_paid FROM contract_status WHERE _contract_id = C.id ORDER BY date_entered DESC LIMIT 1),0) AS amount_paid, \n''_NEW_STATUS_'' AS status,\n'''' AS document_urls, \n''AUTOMATIC NOTE ADDED: _NEW_STATUS_ status added'' AS notes, \nNOW() AS date_entered, \n''_USER_ID_'' AS _entered_by, \n''_ORGANIZATION_ID_'' AS _entered_by_organization_id\n\nFROM contracts C WHERE id IN (''_ID_LIST_''))'),
(118, 'get_tender_by_reference_number', 'SELECT * FROM tender_notices WHERE reference_number=''_REFERENCE_NUMBER_'''),
(120, 'update_provider_suspension', 'UPDATE organizations SET expiry_date=NOW(), status=''suspended'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id IN (''_ID_LIST_'')'),
(121, 'terminate_provider_projects', 'UPDATE contracts SET status = ''terminated'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE _organization_id IN (''_ID_LIST_'')'),
(122, 'add_termination_status_due_to_suspension', 'INSERT INTO contract_status (_contract_id, percentage, amount_spent, amount_paid, status, document_urls, notes, date_entered, _entered_by, _entered_by_organization_id)\n\n(SELECT C.id AS _contract_id, \n(SELECT MAX(percentage) FROM contract_status WHERE _contract_id=C.id) AS percentage, ''0'' AS amount_spent, \n''0'' AS amount_paid, \n''terminated'' AS status, \n'''' AS document_urls, \n''Contract terminated due to provider suspension.'' AS notes, \nNOW() AS date_entered, \n''_USER_ID_'' AS _entered_by, \n''_ORGANIZATION_ID_'' AS _entered_by_organization_id\n\nFROM contracts C WHERE _organization_id IN (''_ID_LIST_''))'),
(123, 'terminate_provider_contracts', 'UPDATE contracts SET status=''terminated'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE _organization_id IN (''_ID_LIST_'')'),
(124, 'get_permission_groups', 'SELECT id AS group_id, name FROM permission_groups ORDER BY name'),
(125, 'update_user_permission_group', 'UPDATE users SET _permission_group_id=''_GROUP_ID_'' WHERE id IN (''_ID_LIST_'')'),
(126, 'get_procurement_plan_by_data', 'SELECT * FROM procurement_plans WHERE _organization_id=''_PDE_ID_'' AND financial_year_start=''_FINANCIAL_YEAR_START_'' AND financial_year_end=''_FINANCIAL_YEAR_END_'''),
(127, 'edit_procurement_plan', 'UPDATE procurement_plans SET title=''_TITLE_'', status=''_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'' WHERE id=''_PLAN_ID_'''),
(128, 'remove_plan_detail_rows', 'DELETE FROM procurement_plan_details WHERE _plan_id=''_PLAN_ID_'''),
(129, 'add_plan_detail_row', 'INSERT INTO procurement_plan_details (_plan_id, _category_id, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, _entered_by, date_entered) VALUES \n\n(''_PLAN_ID_'', ''_CATEGORY_ID_'', ''_A_'', ''_B_'', ''_C_'', ''_D_'', ''_E_'', ''_F_'', ''_G_'', ''_H_'', ''_I_'', ''_J_'', ''_K_'', ''_L_'', ''_M_'', ''_N_'', ''_O_'', ''_USER_ID_'', NOW())'),
(130, 'get_procurement_plan_details', 'SELECT id, _plan_id, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, _entered_by, date_entered  FROM procurement_plan_details WHERE _plan_id=''_PLAN_ID_'' ORDER BY IF(NOW() > DATE(''2016-01-28 05:40:24''), _category_id, id), date_entered'),
(131, 'update_procurement_plan_detail', 'UPDATE procurement_plan_details SET _COLUMN_ID_=''_NEW_VALUE_'' WHERE id=''_ROW_ID_'''),
(132, 'get_plan_by_financial_period', 'SELECT *, id AS plan_id FROM procurement_plans WHERE _organization_id=''_ORGANIZATION_ID_'' AND financial_year_start=''_FINANCIAL_YEAR_START_'' AND financial_year_end=''_FINANCIAL_YEAR_END_'''),
(133, 'search_procurement_plan_subject_list', 'SELECT id AS subject_id, B AS name, C AS display_method \r\nFROM procurement_plan_details \r\nWHERE D <> '''' AND _plan_id=''_PLAN_ID_'' AND B LIKE ''%_PHRASE_%'' _LIMIT_TEXT_'),
(134, 'edit_tender_notice', 'UPDATE tender_notices SET name=''_NAME_'', subject_id=''_SUBJECT_ID_'', details=''_DETAILS_'', type=''_TYPE_'', \n\n_category_id = (SELECT C.id FROM procurement_categories C WHERE LOWER(name) = LOWER(IFNULL((SELECT B FROM procurement_plan_details WHERE _plan_id=''_PROCUREMENT_PLAN_ID_'' AND SUBSTRING_INDEX((SELECT A FROM procurement_plan_details WHERE id=''_SUBJECT_ID_'' LIMIT 1), ''.'',1) = A LIMIT 1), ''Other''))),\n\nmethod = (SELECT LOWER(REPLACE(C,'' '',''_'')) FROM procurement_plan_details WHERE id=''_SUBJECT_ID_'' LIMIT 1),\n_organization_id = (SELECT _organization_id FROM procurement_plans WHERE id=''_PROCUREMENT_PLAN_ID_'' LIMIT 1),\n\ndocument_url = IF(''_DOCUMENT_URL_''<>'''', ''_DOCUMENT_URL_'', document_url), \n\ndeadline = ''_DEADLINE_'', \ndisplay_start_date=''_DISPLAY_START_DATE_'', display_end_date=''_DISPLAY_END_DATE_'', status=''_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_''\n\nWHERE id=''_TENDER_ID_'''),
(135, 'mark_best_evaluated_bidder', 'UPDATE bids SET \nstatus = IF(id = ''_BID_ID_'', ''won'', ''complete''), \nlast_updated=NOW(), \n_last_updated_by=''_USER_ID_''\n\nWHERE _tender_notice_id=''_TENDER_ID_'''),
(136, 'add_best_evaluated_reason', 'INSERT INTO bid_evaluation_reasons (_tender_notice_id, _bid_id, reason, date_entered, _entered_by, last_updated, _last_updated_by) \nVALUES \n(''_TENDER_ID_'', ''_BID_ID_'', ''_REASON_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')\n\nON DUPLICATE KEY UPDATE reason=''_REASON_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'''),
(137, 'get_tender_provider_bids', 'SELECT B.id AS bid_id, B.bid_currency, B.bid_amount, \n\n(SELECT name FROM organizations WHERE id=B._organization_id LIMIT 1) AS provider_name, \n\nIFNULL((SELECT reason FROM bid_evaluation_reasons WHERE _tender_notice_id=''_TENDER_ID_'' AND _bid_id=B.id LIMIT 1), '''') AS reason,\n\nIFNULL((SELECT id FROM bids WHERE _tender_notice_id=''_TENDER_ID_'' AND status=''won'' LIMIT 1), '''') AS winner_bid\n\nFROM bids B \nWHERE B._tender_notice_id = ''_TENDER_ID_'''),
(138, 'update_tender_bid_price', 'UPDATE tender_notices SET \r\nwinner_bid_price=''_BID_PRICE_'', winner_bid_currency=''_BID_CURRENCY_'', last_updated=NOW(), _last_updated_by=''_USER_ID_''\r\n\r\nWHERE id=''_TENDER_ID_'''),
(139, 'remove_plan_detail_item', 'DELETE FROM procurement_plan_details WHERE id=''_DETAIL_ID_'''),
(140, 'get_raw_report_item', 'SELECT PD.*, \n\n(SELECT id FROM procurement_categories \nWHERE name=(SELECT B FROM procurement_plan_details \nWHERE A=SUBSTRING_INDEX(PD.A,''.'',1) AND _plan_id=PD._plan_id LIMIT 1) LIMIT 1) AS category_id,\n\nLOWER(REPLACE(C, '' '', ''_'')) AS method_code\n\nFROM procurement_plan_details PD WHERE id=''_DETAIL_ID_'''),
(141, 'add_missing_detail_category', 'INSERT INTO procurement_plan_details (_plan_id, A, B, _entered_by, date_entered) \n\nSELECT D._plan_id, D.A, D.B, D._entered_by, D.date_entered FROM \n(SELECT ''_PLAN_ID_'' AS _plan_id, \n\n( SELECT (LABELS.category_label + 1)\nFROM \n(SELECT SUBSTRING_INDEX(A,''.'',1) AS category_label, IF(A LIKE ''%.%'', SUBSTRING_INDEX(A,''.'',-1), '''') AS item_label \nFROM procurement_plan_details \nWHERE _plan_id=''_PLAN_ID_''\nHAVING item_label = ''''\nORDER BY (category_label+0) DESC, (item_label+0) DESC \nLIMIT 1) LABELS \n) AS A, \n\n(SELECT name FROM procurement_categories WHERE id=''_CATEGORY_ID_'') AS B,\n''_USER_ID_'' AS _entered_by, NOW() AS date_entered) D \n\nWHERE (SELECT id FROM procurement_plan_details \nWHERE _plan_id=''_PLAN_ID_'' \nAND B=(SELECT name FROM procurement_categories WHERE id=''_CATEGORY_ID_'')) IS NULL'),
(142, 'get_next_row_label', 'SELECT CONCAT(LABELS.category_label,''.'',IF(LABELS.item_label = '''', ''1'', (LABELS.item_label + 1))) AS label\r\nFROM \r\n(SELECT SUBSTRING_INDEX(A,''.'',1) AS category_label, IF(A LIKE ''%.%'', SUBSTRING_INDEX(A,''.'',-1), '''') AS item_label \r\nFROM procurement_plan_details \r\nWHERE _plan_id=''_PLAN_ID_'' \r\n\r\nHAVING category_label = (SELECT A FROM procurement_plan_details \r\n	WHERE B = (SELECT name FROM procurement_categories WHERE id=''_CATEGORY_ID_'') LIMIT 1)\r\n\r\nORDER BY (category_label+0) DESC, (item_label+0) DESC \r\nLIMIT 1) LABELS '),
(143, 'end_registration_status', 'UPDATE registration_status_track SET end_date=NOW() \r\nWHERE _organization_id IN (''_ID_LIST_'')'),
(144, 'add_registration_status', 'INSERT INTO registration_status_track (_organization_id, status, reason, start_date, end_date, _entered_by) \r\n(SELECT id AS _organization_id, ''_STATUS_'' AS status, ''_REASON_'' AS reason, NOW() AS start_date, ''_END_DATE_'' AS end_date, ''_USER_ID_'' AS _entered_by\r\nFROM organizations WHERE id IN (''_ID_LIST_''))'),
(145, 'update_user_password', 'UPDATE users SET password=''_PASSWORD_'', last_updated=NOW(), _last_updated_by = ''_USER_ID_'' WHERE id=''_USER_ID_'''),
(146, 'get_procurement_plan_latest_date', 'SELECT date_entered AS latest_date FROM procurement_plans WHERE status=''published'' ORDER BY date_entered DESC LIMIT 1'),
(147, 'get_provider_latest_date', 'SELECT IFNULL((SELECT start_date FROM registration_status_track WHERE _organization_id=O.id AND status=O.status ORDER BY start_date DESC LIMIT 1), NOW()) AS latest_date \r\n\r\nFROM organizations O \r\nWHERE (SELECT G.type FROM users U LEFT JOIN permission_groups G ON (G.id=U._permission_group_id) WHERE U.id=O._owner_user_id LIMIT 1) = ''provider''\r\nAND status=''active''\r\n\r\nORDER BY latest_date DESC LIMIT 1'),
(148, 'get_document_latest_date', 'SELECT date_entered AS latest_date FROM documents WHERE status=''active''  AND document_type=''system'' ORDER BY date_entered DESC LIMIT 1'),
(149, 'get_forum_latest_date', 'SELECT last_updated AS latest_date FROM forums WHERE status=''active''  AND is_public = ''Y'' ORDER BY last_updated DESC LIMIT 1'),
(150, 'get_registration_certificate', 'SELECT id AS document_id, IF(expiry_date <> ''0000-00-00'', expiry_date, '''') AS expiry_date FROM organizations WHERE rop_number = ''_TRACKING_NUMBER_'' LIMIT 1'),
(151, 'get_training_certificate', 'SELECT id AS document_id, date_entered AS expiry_date FROM event_attendance WHERE certificate_number = ''_TRACKING_NUMBER_'' LIMIT 1'),
(152, 'add_tender_bidder', 'INSERT INTO tender_invitations (_tender_id, _provider_id, note, status, date_entered, _entered_by, last_updated, _last_updated_by)\r\n\r\nVALUES (''_TENDER_ID_'', ''_PROVIDER_ID_'', ''_NOTE_'', ''_STATUS_'', NOW(), ''_USER_ID_'',NOW(), ''_USER_ID_'')\r\n\r\nON DUPLICATE KEY \r\nUPDATE note=''_NOTE_'', status=''_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_'''),
(153, 'get_tender_invitations', 'SELECT I._tender_id AS tender_id, I._provider_id AS provider_id, I.note, I.date_entered AS first_invited, I.last_updated AS last_invited, \r\n\r\n(SELECT name FROM organizations WHERE id=I._provider_id LIMIT 1) AS provider, \r\n\r\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=I._entered_by LIMIT 1) AS first_invited_by, \r\n\r\n(SELECT CONCAT(first_name, '' '', last_name) FROM users WHERE id=I._last_updated_by LIMIT 1) AS last_invited_by\r\n\r\nFROM tender_invitations I \r\nWHERE I._tender_id = ''_TENDER_ID_'' AND I.status = ''active'' \r\nORDER BY I.last_updated DESC '),
(154, 'get_forum_comment_by_id', 'SELECT comment FROM forum_comments WHERE id=''_COMMENT_ID_'''),
(155, 'remove_forum_comment', 'DELETE FROM forum_comments WHERE id=''_COMMENT_ID_'''),
(156, 'add_organization_user', 'INSERT INTO users (first_name, last_name, _organization_id, email_address, telephone, country, user_name, password, _permission_group_id, status, date_entered, _entered_by, last_updated, _last_updated_by) \r\nVALUES \r\n(''_FIRST_NAME_'', ''_LAST_NAME_'', ''_ORGANIZATION_ID_'', ''_EMAIL_ADDRESS_'', ''_TELEPHONE_'', ''_COUNTRY_'', ''_USER_NAME_'', ''_PASSWORD_'', ''_PERMISSION_GROUP_ID_'', ''_STATUS_'', NOW(), ''_USER_ID_'', NOW(), ''_USER_ID_'')'),
(157, 'edit_organization_user', 'UPDATE users \r\nSET first_name=''_FIRST_NAME_'', last_name=''_LAST_NAME_'',  email_address=''_EMAIL_ADDRESS_'', telephone=''_TELEPHONE_'', country=''_COUNTRY_'', password=''_PASSWORD_'', _permission_group_id=''_PERMISSION_GROUP_ID_'', status=''_STATUS_'', last_updated=NOW(), _last_updated_by=''_USER_ID_''\r\n\r\nWHERE id=''_EDIT_ID_'''),
(158, 'get_cron_schedule', 'SELECT * FROM cron_schedule WHERE is_done=''_IS_DONE_'' _EXTRA_CONDITIONS_ _LIMIT_TEXT_'),
(159, 'update_cron_schedule_field', 'UPDATE cron_schedule SET _FIELD_NAME_=''_FIELD_VALUE_'' WHERE id=''_ID_'''),
(160, 'add_cron_log', 'INSERT INTO activity_trail (user_id, activity_code, result, uri, log_details, ip_address, event_time) \nVALUES \n(''_USER_ID_'', ''_ACTIVITY_CODE_'', ''_RESULT_'', ''_URI_'', ''_LOG_DETAILS_'', ''_IP_ADDRESS_'', NOW())'),
(161, 'get_cron_job_by_id', 'SELECT * FROM cron_schedule WHERE id=''_JOB_ID_'''),
(162, 'get_system_files', 'SELECT TRIM(BOTH '','' FROM A.file_url) AS file_url FROM \n((SELECT document_url AS file_url FROM bid_documents WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day)) \n\nUNION \n\n(SELECT document_urls AS file_url FROM contract_status WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day)) \n\nUNION \n\n(SELECT url AS file_url FROM documents WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day)) \n\nUNION \n\n(SELECT certificate_url AS file_url FROM event_attendance WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\nUNION \n\n(SELECT document_url AS file_url FROM forums WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\nUNION \n\n(SELECT attachment_url AS file_url FROM message_exchange WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\nUNION \n\n(SELECT CONCAT(logo_url,'','',rop_certificate_url) AS file_url FROM organizations WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\nUNION \n\n(SELECT document_url AS file_url FROM procurement_plans WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\nUNION \n\n(SELECT document_url AS file_url FROM tender_notices WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\nUNION \n\n(SELECT photo_url AS file_url FROM users WHERE DATE(date_entered) >= DATE(''_LAST_RAN_'') AND DATE(date_entered) < DATE_SUB(NOW(), INTERVAL _EXPIRY_DAYS_ day))\n\n) A\n\nHAVING file_url <> '''''),
(163, 'search_contract_awards', 'SELECT id AS contract_id, _tender_id AS tender_id, name\n\nFROM contracts \nWHERE status IN (''active'',''complete'',''endorsed'',''commenced'') AND name LIKE ''%_PHRASE_%''\nGROUP BY name \nORDER BY last_updated DESC \n _LIMIT_TEXT_'),
(164, 'search_active_provider_list', 'SELECT O.id AS provider_id, O.name, O.name AS provider \r\nFROM organizations O LEFT JOIN users U ON (O._owner_user_id=U.id) LEFT JOIN permission_groups G ON (U._permission_group_id=G.id) \r\n\r\nWHERE G.type = ''provider'' AND O.status = ''active'' AND O.name LIKE ''%_PHRASE_%'' _LIMIT_TEXT_');

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
